<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="option_header_brand_logo_inherited" inherit_id="website.placeholder_header_brand" name="Header Brand Logo" active="True">
        <xpath expr="//a[@href='/']" position="replace">
            <a href="/" t-attf-class="navbar-brand logo #{_link_class}">
                <div id="website_company_logo" class="d-flex align-items-center">
                    <span t-if="request.env.user.company_id.logo">
                        <span t-field="request.env.user.company_id.logo" t-options="{'widget': 'image', 'width': 80, 'height': 80}" 
                              role="img" t-att-aria-label="'Logo of %s' % website.get_company_name()" 
                              t-att-title="website.get_company_name()" 
                              t-att-alt="'Logo of %s' % website.get_company_name()" />
                    </span>
                    <span t-else="">
                        <p>No logo available</p>
                    </span>
                </div>                
            </a>
        </xpath>
    </template>
    <template id="website_contactus_inherit" inherit_id="website.contactus" name="Contact Us">
        <xpath expr="//div[@class='col-lg-4 mt-4 mt-lg-0']//ul" position="replace">
            <ul class="list-unstyled">
                <li><span t-esc="website.get_company_id().name_np"/></li>
                <li><i class="fa fa-map-marker fa-fw me-2"></i><span t-esc="website.get_company_id().street_np"/></li>
                <li><i class="fa fa-phone fa-fw me-2"></i><span t-esc="website.get_company_id().phone"/></li>
                <li><i class="fa fa-envelope fa-fw me-2"></i><span t-esc="website.get_company_id().email"/></li>
                <li><i class="fa fa-bullhorn fa-fw me-2"></i><span t-esc="website.get_company_id().fax_number"/></li>
                <li><i class="fa fa-globe fa-fw me-2"></i><a t-esc="website.get_company_url()"/></li>
            </ul>
        </xpath>
    </template>
    <template id="web_register_template" name="Company Register">
    <t t-name="web.register">
        <t t-call="website.layout">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
            <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script src="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/js/nepali.datepicker.v4.0.4.min.js" type="text/javascript"></script>
            <link href="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/css/nepali.datepicker.v4.0.4.min.css" rel="stylesheet" type="text/css"/>
            <script src="/base_accounting_kit/static/src/js/script.js"></script>

            <link rel="stylesheet" type="text/css" href="/base_accounting_kit/static/src/css/app.css"/>
     
                <div class="container container-register">
                    <div class="header-box text-center">
                        <h2 class="mb-0"> <t t-translation="True">Register Your Company</t></h2>
                    </div>

                    <div class="d-none doNotCloseThisWindow" id="doNotCloseThisWindow">
                       <t t-translation="True"> PAYMENT PROCESSING...PLEASE, DO NOT CLOSE THIS WINDOW!!</t>
                        <img class="loading" src="/base_accounting_kit/static/images/loading.gif" alt="loading..."/>
                    </div>

                   
                    <form class="oe_register_form" role="form" id="mainForm" t-attf-action="/company/register" method="post" enctype="multipart/form-data">
                        <div class="note"> <t t-translation="True">Note: All fields marked with </t><i class="text-danger">*</i>  <t t-translation="True">are required.</t></div>
                        
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="company_type" class="required"> <t t-translation="True">Company Type</t></label>
                                <select name="company_type" id="company_type" class="form-control" required="required">
                                    <option value=""> <t t-translation="True">Select Company Type</t></option>
                                    <option value="individual"> <t t-translation="True">Individual</t></option>
                                    <option value="organization"> <t t-translation="True">Organization</t></option>
                                </select>
                            </div>
                        </div>

                    <!-- Individual Fields -->
                    <div id="individual_fields" style="display: none;">
                        <div class="row">   

                            <div class="form-group col-md-6">
                                <label for="first_name_en" class="required"> <t t-translation="True">First Name (EN)</t></label>
                                <input type="text" name="first_name_en" id="first_name_en" class="form-control" placeholder="Enter First Name"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="middle_name_en"> <t t-translation="True">Middle Name (EN)</t></label>
                                <input type="text" name="middle_name_en" id="middle_name_en" class="form-control" placeholder="Enter Middle Name"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="last_name_en" class="required"> <t t-translation="True">Last Name (EN)</t></label>
                                <input type="text" name="last_name_en" id="last_name_en" class="form-control" placeholder="Enter Last Name"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="first_name_np" class="required"> <t t-translation="True">First Name (NP)</t></label>
                                <input type="text" name="first_name_np" id="first_name_np" class="form-control" placeholder="Enter First Name in NP"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="middle_name_np"> <t t-translation="True">Middle Name (NP)</t></label>
                                <input type="text" name="middle_name_np" id="middle_name_np" class="form-control" placeholder="Enter Middle Name in NP"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="last_name_np" class="required">Last Name (NP)</label>
                                <input type="text" name="last_name_np" id="last_name_np" class="form-control" placeholder="Enter Last Name in NP"/>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="gender" class="required">Gender</label>
                                <select name="gender" id="gender" class="form-control">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="others">Other</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="login_bg_img_individual">Individual's Picture</label>
                                <input type="file" name="login_bg_img_individual" id="login_bg_img_individual" class="form-control"/>
                            </div>
                        </div>
                    </div>

                    <!-- Organization Fields -->
                    <div id="organization_fields" style="display: none;">
                        <div class="row">

                        <div class="form-group col-md-6">
                            <label for="organization_name_en" class="required">Organization Name (EN)</label>
                            <input type="text" name="organization_name_en" id="organization_name_en" class="form-control" placeholder="Enter Organization Name"/>
                            <small id="organizationNameEnError" class="text-danger"></small>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="organization_name_np" class="required">Organization Name (NP)</label>
                            <input type="text" name="organization_name_np" id="organization_name_np" class="form-control" placeholder="Enter Organization Name in NP"/>
                            <small id="organizationNameNpError" class="text-danger"></small>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="owner_name_en" class="required">Owner Name (EN)</label>
                            <input type="text" name="owner_name_en" id="owner_name_en" class="form-control"  placeholder="Enter Owner Name"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="owner_name_np" class="required">Owner Name (NP)</label>
                            <input type="text" name="owner_name_np" id="owner_name_np" class="form-control" placeholder="Enter Owner Name in NP"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="registration_no">Registration Number</label>
                            <input type="text" name="registration_no" id="registration_no" class="form-control" placeholder="Enter Registration Number"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="start_date">Start Date</label>
                            <input type="text" name="start_date" id="start_date" class="form-control" placeholder="Enter your Start Date"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="organization_type" class="required">Organization Type</label>
                            <select name="organization_type" id="organization_type" class="form-control">
                                <option value="">Select Organization Type</option>
                                <option value="private limited">Private Limited</option>
                                <option value="public limited">Public Limited</option>
                                <option value="user committee">User Committee</option>
                                <option value="proprietary firm">Proprietary Firm</option>
                                <option value="others">Others</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="login_bg_img_company" >Company Logo</label>
                            <input type="file" name="login_bg_img_company" id="login_bg_img_company" class="form-control"/>
                        </div>
                    </div>
                </div>

                    <!-- Common Fields for Both Types -->
                    <div id="common_fields" style="display: none;">
                        <div class="row">

                        <div class="form-group col-md-6">
                            <label for="company_category_ids" class="required">Business Type</label>
                            <select name="company_category_ids[]" id="company_category_ids" required="required" class="form-control js-example-basic-multiple" multiple="multiple" style="width: 100%; max-width: 600px;">
                                <t t-foreach="company_category_ids" t-as="category">
                                    <option t-att-value="category.id" t-att-data-category-id="category.id">
                                        <t t-esc="category.name_np"/>
                                    </option>
                                </t>
                            </select>                            
                        </div>
                        <div class="form-group col-md-6">
                            <label for="total_amount" class="required">Total Amount</label>
                            <input type="text"  required="required" name="total_amount" id="total_amount" class="form-control" placeholder="Total Amount" readonly="1" min="1"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="tax_id">Tax ID</label>
                            <input type="text" name="tax_id" id="tax_id" class="form-control" placeholder="Enter Tax ID"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="recent_tax_paid_year">Recent Tax Paid Year</label>
                            <input type="text" name="recent_tax_paid_year" id="recent_tax_paid_year" class="form-control" placeholder="Enter Recent Tax Paid Year"/>
                        </div>
                       <div class="form-group col-md-6">
                            <label for="pan_number" class="required">PAN Number</label>
                            <input type="text"  name="pan_number" id="pan_number" class="form-control" placeholder="Enter PAN number" maxlength="9" minlength="9" pattern="\d{9}" title="PAN Number must be exactly 9 digits" required="required"/>
                            <small id="panError" class="text-danger"></small>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="email" class="required">Email</label>
                            <input type="email" name="email" id="email" class="form-control" placeholder="Enter email address" title="Please enter a valid email address" required="required"/>
                            <small id="emailError" class="text-danger"></small>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="mobile" class="required">Mobile</label>
                            <input type="text" name="mobile" id="mobile" class="form-control" placeholder="Enter mobile number" maxlength="10" minlength="10" pattern="^(97|98)\d{8}$" title="Mobile number must be exactly 10 digits long and start with 97 or 98" required="required"/>
                            <small id="mobileError" class="text-danger"></small>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="phone">Phone</label>
                            <input type="text" name="phone" id="phone" class="form-control" placeholder="Enter phone number"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="owner_citizenship_front">Owner Citizenship (Front)</label>
                            <input type="file" name="owner_citizenship_front" id="owner_citizenship_front" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="owner_citizenship_back">Owner Citizenship (Back)</label>
                            <input type="file" name="owner_citizenship_back" id="owner_citizenship_back" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="province" class="required">Province</label>
                            <select name="province" id="province" class="form-control">
                                <option value="">Select Province</option>
                                <t t-foreach="provinces" t-as="province">
                                    <option t-att-value="province.id"><t t-esc="province.name_np"/></option>
                                </t>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="district" class="required">District</label>
                            <select name="district" id="district" class="form-control">
                                <option value="">Select District</option>
                                <t t-foreach="districts" t-as="district">
                                    <option t-att-value="district.id"><t t-esc="district.district_name_np"/></option>
                                </t>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="palika" class="required"><t t-translation="True">Palika</t></label>
                            <select name="palika" id="palika" class="form-control">
                                <option value=""><t t-translation="True">Select Palika</t></option>
                                <t t-foreach="palikas" t-as="palika">
                                    <option t-att-value="palika.id"><t t-esc="palika.palika_name_np"/></option>
                                </t>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="ward_no"><t t-translation="True">Ward No</t></label>
                            <input type="number" min='1' name="ward_no" id="ward_no" class="form-control" placeholder="Enter Ward No"/>
                        </div>
                        <div class="col-md-12 js_location_autocomplete position-relative mb-3">
                            <div class="input-group-meta position-relative mb-25">
                            <label for="address"><t t-translation="True">Address For Pickup</t></label>
                            <input type="text" id="address" name="pickup_location" class="form-control" placeholder="Laxmi Fancy &amp; Cosmetic Center, Nilkantha-5, Dhading"  required="True"  autocomplete="new-password"/>
                            <span class="c-text-sm text-muted"><t t-translation="True">(Optional if you are not going to sell on e-commerce platform and you must pick from the given list of addresses.)</t></span>
                            <input type='hidden' id='address_latitude' />
                            <input type='hidden' id='address_longitude' />

                            <ul
                                id="location-suggestions"
                                class="list-group position-absolute w-100 suggestions"
                            >
                            </ul>

                            </div>

                    </div>
                        
                        
                        <input type="hidden" name="business_second_ids" id="payment-second-business-ids"/>
                    </div>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" id="submitButton" style="display: none">Register</button>
                    </div>
                </form>
                <form class="oe_register_form oe_register py-3" target="_blank" id="secondaryForm" role="form" t-attf-action="/registration/proceed-to-payment" method="post" enctype="multipart/form-data">
                    <div>    
                        <input type="hidden" name="email" value="email" id="payment-email-id"/>
                        <input type="hidden" name="phone" value="mobile" id="payment-phone"/>
                        <input type="hidden" name="business_ids" value="business_second_ids" id="payment-business-ids"/>
                        <input type="hidden" name="amount" value="total_amount" id="payment-amount"/>
                    </div>
                    <div class="text-center z-10">
                        <button type="submit" class="btn btn-primary  z-10" id='proceedToPayment' >Proceed to Payment</button>
                        <!-- <button type="submit" class="btn btn-primary" id='updateDetails' >Update Details</button> -->
                    </div>
                    <div class="d-center">
                    <a href="/web/login" title="Login instead">Login Instead?</a>
                    </div>
                    <div class="d-none mt-4"  id="paymentUnsuccess">
                        PAYMENT UNSUCCESSFUL...PLEASE TRY AGAIN!!
                     </div>
                </form>
                </div>
        </t>
        </t>
        <script type="text/javascript">

                let duplicate_state = true;
                $(document).ready(function() {
                    // Collect IDs from the select options
                    var ids = [];
                    $('#company_category_ids option').each(function() {
                        // Make sure to check if data-category-id exists
                        var categoryId = $(this).data('category-id');
                        if (categoryId !== undefined) {
                            ids.push(categoryId);
                        }
                    });
                    
                    // Make an AJAX call to fetch the pricing based on category IDs
                    if (ids.length > 0) {
                        $.ajax({
                            url: "/pricing_name",
                            method: "GET",
                            data: { ids: ids.join(',') },
                            dataType: "json",  // Expect a JSON response from the server
                            success: function(response) {
                                if (response.pricing) {
                                    // Loop through the pricing data and update the dropdown options
                                    response.pricing.forEach(function(item) {
                                        // Find the option by data-category-id and update its text while keeping the id intact
                                        var option = $('#company_category_ids option[data-category-id="' + item.id + '"]');
                                        if (option.length) {
                                            option.text(item.name + " (" + item.pricing + ")");
                                        }
                                    });
                                } else {
                                    console.warn("No pricing data returned from server.");
                                }
                            },
                            error: function(xhr, status, error) {
                                console.error("Failed to fetch pricing data. Status: ", status, "Error: ", error);
                            }
                        });
                    }  

            function checkFieldDuplicate(fieldId, fieldName, model, errortag) {
            console.log("Function triggered");
            const value = $(fieldId).val().trim();
            console.log("Value:", value);

            if (value !== '') {
                const formData = new URLSearchParams();
                formData.append('value', value);
                formData.append('field', fieldName);
                formData.append('model', model);
                console.log("Form Data:", formData.toString());

                $.ajax({
                url: "/check_duplicate",
                method: "POST",
                contentType: "application/x-www-form-urlencoded",
                data: formData.toString(),
                success: function(response) {
                    let jsonResponse = response;
                    if (typeof response !== 'object') {
                        try {
                            jsonResponse = JSON.parse(response); // Handle stringified JSON response
                        } catch (e) {
                            console.error("Error parsing JSON response:", e);
                            return;
                        }
                    }
                    
                    console.log("Parsed Response:", jsonResponse); // Ensure it's logging
                    const errorElement = $(`${errortag}`);
                    if (jsonResponse.success) {
                        console.log("Success response received.");
                        if (jsonResponse.duplicate) {
                            console.log("Duplicate value found.");
                            errorElement.text(jsonResponse.message);
                        } else {
                            errorElement.text('');
                        }
                    } else {
                        errorElement.text(jsonResponse.message || 'Unexpected error occurred.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error Response:", xhr.responseText, "Status:", status, "Error:", error);
                    const errorMessage = xhr.responseJSON?.message || 'Error checking value. Please try again.';
                    $(`${fieldId}Error`).text(errorMessage);
                }
            });

            } else {
                console.log("Empty value, no request made.");
            }
        }



                $('#organization_name_en').on('input', function() {
                    checkFieldDuplicate('#organization_name_en', 'organization_name_en', 'company.register', '#organizationNameEnError');
                });

                $('#organization_name_np').on('input', function() {
                    checkFieldDuplicate('#organization_name_np', 'organization_name_np', 'company.register', '#organizationNameNpError');
                });


                $('#pan_number').on('input', function() {
                    const pan = $(this).val();
                    const panPattern = /^\d{9}$/;

                    if (!panPattern.test(pan)) {
                        $('#panError').text('PAN number must be exactly 9 digits.');
                    } else {
                        $('#panError').text(''); // Clear the format error first
                        checkFieldDuplicate('#pan_number', 'pan_number', 'company.register','#panError');
                    }
                });


                    // Email Validation
                    $('#email').on('input', function() {
                        const email = $(this).val();
                        const emailPattern = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
                        if (!emailPattern.test(email)) {
                            $('#emailError').text('Please enter a valid email address.');
                        } else {
                            $('#emailError').text('');
                            checkFieldDuplicate('#email', 'email', 'company.register','#emailError');
                        }
                    });

                    // Mobile Validation
                    $('#mobile').on('input', function() {
                        const mobile = $(this).val();
                        const mobilePattern = /^(97|98)\d{8}$/;
                        if (!mobilePattern.test(mobile)) {
                            $('#mobileError').text('Mobile number must be exactly 10 digits and start with 97 or 98.');
                        } else {
                            $('#mobileError').text('');
                            checkFieldDuplicate('#mobile', 'mobile', 'company.register','#mobileError');
                        }
                    });

                    // Prevent form submission if errors exist
                    $('#mainForm').on('submit', function(e) {
                        let hasErrors = false;

                        // Check for empty PAN number
                        if (!$('#pan_number').val()) {
                            $('#panError').text('PAN number is required.');
                            hasErrors = true;
                        } else if (!$('#panError').text()) {
                            $('#panError').text(''); // Clear any previous error message
                        }

                        // Check for empty Email
                        if (!$('#email').val()) {
                            $('#emailError').text('Email is required.');
                            hasErrors = true;
                        } else if (!$('#emailError').text()) {
                            $('#emailError').text(''); // Clear any previous error message
                        }

                        // Check for empty Mobile
                        if (!$('#mobile').val()) {
                            $('#mobileError').text('Mobile number is required.');
                            hasErrors = true;
                        } else if (!$('#mobileError').text()) {
                            $('#mobileError').text(''); // Clear any previous error message
                        }

                        // If any errors are present, prevent form submission
                        if (hasErrors || $('#panError').text() || $('#emailError').text() || $('#mobileError').text()) {
                            e.preventDefault(); // Prevent form submission if there are validation errors
                            alert('Please fix the errors before submitting.');
                        }
                    });
                });




                document.addEventListener('DOMContentLoaded', function() {
                    const emailInput = document.getElementById('email');
                    const mobileInput = document.getElementById('mobile');
                    const businessSelect = document.getElementById('company_category_ids');
                    const amountInput = document.getElementById('total_amount');

                    const paymentEmailInput = document.getElementById('payment-email-id');
                    const paymentPhoneInput = document.getElementById('payment-phone');
                    const paymentBusinessIdsInput = document.getElementById('payment-business-ids');
                    const paymentAmountInput = document.getElementById('payment-amount');

                    // Function to update the payment form fields
                    function updatePaymentForm() {
                        paymentEmailInput.value = emailInput.value;
                        paymentPhoneInput.value = mobileInput.value;
                        paymentAmountInput.value = amountInput.value;

                        // Get selected business IDs
                        const selectedOptions = Array.from(businessSelect.selectedOptions);
                        const selectedValues = selectedOptions.map(option => option.value);
                        paymentBusinessIdsInput.value = selectedValues.join(',');
                    }

                    // Add event listeners to inputs
                    emailInput.addEventListener('input', updatePaymentForm);
                    mobileInput.addEventListener('input', updatePaymentForm);
                    businessSelect.addEventListener('change', updatePaymentForm);
                    amountInput.addEventListener('input', updatePaymentForm);
                });

                $(document).ready(function() {
                    $('.js-example-basic-multiple').select2().on('change', function() {
                        const fake_ids = document.getElementById('payment-second-business-ids');
                        const selectedValues = $(this).val();

                        // Filter only numeric IDs to avoid invalid entries
                        const numericValues = selectedValues.filter(val => !isNaN(val));
                        
                        if (numericValues.length > 0) {
                            // Fetch pricing data based on selected company_category_ids
                            fake_ids.value = numericValues.join(',');
                            fetchPricingData(numericValues);
                        } else {
                            // Reset total amount if no category is selected
                            fake_ids.value = '';
                            $('#total_amount').val('');
                        }
                    });
                });

                function fetchPricingData(selectedIds) {
                    fetch(`/pricing?ids=${selectedIds.join(',')}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        let totalAmount = 0;

                        if (data.pricing) {
                            data.pricing.forEach(price => {
                                totalAmount += price; // Assuming price is a float
                            });
                        }

                        $('#total_amount').val(totalAmount); // Update the amount field
                    })
                    .catch(error => console.error('Error fetching pricing data:', error));
                }

            document.getElementById('secondaryForm').addEventListener('submit', function(event) {
                if($('#total_amount').val() &lt; 1){

                    const Toast2 = Swal.mixin({
                        toast: true,
                        position: "top-end",
                        showConfirmButton: false,
                        showCloseButton: true,
                        timer: null,
                        timerProgressBar: false,
                        didOpen: (toast) => {
                          toast.onmouseenter = Swal.stopTimer;
                          toast.onmouseleave = Swal.resumeTimer;
                        }
                      });
                      Toast2.fire({
                        icon: "error",
                        title: "भुक्तानी रकम 0 भन्दा बढी हुनुपर्छ।"
                      });
                }
                event.preventDefault();
                var mainForm=document.getElementById('mainForm');
                function checkDuplicateState() {
                    const panError = document.querySelector('#panError').innerText.trim();
                    const mobileError = document.querySelector('#mobileError').innerText.trim();
                    const emailError = document.querySelector('#emailError').innerText.trim();
                    
                    // If any of the error elements are not empty, set duplicate_state to false
                    return !(panError || mobileError || emailError);
                }

                let duplicate_state = checkDuplicateState();
                console.log(duplicate_state);
                if (mainForm.checkValidity() &amp;&amp; duplicate_state) {
                   $(this).submit();
                   $('#proceedToPayment').prop('disabled', true);
                   $('#doNotCloseThisWindow').removeClass('d-none');
                   $('#doNotCloseThisWindow').addClass('doNotCloseThisWindow');
                   setTime=0;
                   timer=30 * 60 * 1000;

                   let timeInterval = setInterval(() => {
                    setTime += 1000;
                
                    if (setTime >= timer) {
                        clearInterval(fetchInterval);
                        clearInterval(timeInterval);
                        window.scrollTo(0, 0);
                        $('#proceedToPayment').prop('disabled', false);
                        $('#doNotCloseThisWindow').addClass('d-none');
                        $('#doNotCloseThisWindow').removeClass('doNotCloseThisWindow');
                        $('#paymentUnsuccess').removeClass('d-none');
                    }
                }, 1000);

                var fetchInterval=setInterval(function() {
                    try {
                        $.ajax({
                            type: 'get',
                            url: '/get-payment-status/' + $('#email').val(),
                            success: function (result) {
                                if (result.success) {
                                    mainForm.submit();
                
                                }
                            }
                        });
                
                    } catch (error) {
                        console.error('Error',error);
                    }
                },5000);

                } else {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: "top-end",
                        showConfirmButton: false,
                        showCancelIcon: true,
                        timer: null,
                        timerProgressBar: false,
                        didOpen: (toast) => {
                          toast.onmouseenter = Swal.stopTimer;
                          toast.onmouseleave = Swal.resumeTimer;
                        }
                      });
                      Toast.fire({
                        icon: "error",
                        title: "फारम अमान्य छ। कृपया आवश्यक क्षेत्रहरू जाँच गर्नुहोस् र पुन: प्रयास गर्नुहोस्।"
                      });
                }
            });

            $(document).ready(function() {
                $('.js-example-basic-multiple').select2();
            });

            document.addEventListener('DOMContentLoaded', function() {
                // Initial setup: Hide individual and organization fields
                document.getElementById('individual_fields').style.display = 'none';
                document.getElementById('organization_fields').style.display = 'none';

                document.getElementById('company_type').addEventListener('change', function() {
                    var selectedValue = this.value;

                    // Hide all fields initially
                    document.getElementById('individual_fields').style.display = 'none';
                    document.getElementById('organization_fields').style.display = 'none';
                    document.getElementById('common_fields').style.display = 'none';

                    // Show respective fields based on selection
                    if (selectedValue === 'individual') {
                        document.getElementById('individual_fields').style.display = 'block';
                        document.getElementById('common_fields').style.display = 'block';
                    } else if (selectedValue === 'organization') {
                        document.getElementById('organization_fields').style.display = 'block';
                        document.getElementById('common_fields').style.display = 'block';
                    }
                });
            });
            
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.querySelector('form');
                const submitButton = document.getElementById('submitButton');
                const provinceSelect = document.getElementById('province');
                const districtSelect = document.getElementById('district');
                const palikaSelect = document.getElementById('palika');

                <!-- submitButton.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent the default form submission

                    console.log("Button clicked");
                    // Your other console.log statements here
                    // Delay the form submission
                    setTimeout(function() {
                        // Create hidden inputs for each selected option
                        // Your code for creating hidden inputs goes here

                        // Submit the form programmatically
                        form.submit();
                    }, 1000000); // 2000 milliseconds (2 seconds) delay
                }); -->
        
                // Function to fetch districts based on selected province
                function fetchDistricts(provinceId) {
                    districtSelect.innerHTML = '<option value="">Select District</option>';
                    palikaSelect.innerHTML = '<option value="">Select Palika</option>'; // Clear palikas
                    if (provinceId) {
                        fetch(`/district/${provinceId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.districts.forEach(district => {
                                    const option = new Option(district.name, district.id);
                                    districtSelect.add(option);
                                });
                            });
                    }
                }
        
                // Function to fetch palikas based on selected district
                function fetchPalikas(districtId) {
                    palikaSelect.innerHTML = '<option value="">Select Palika</option>'; // Clear palikas
                    if (districtId) {
                        fetch(`/palika/${districtId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.palikas.forEach(palika => {
                                    const option = new Option(palika.name, palika.id);
                                    palikaSelect.add(option);
                                });
                            });
                    }
                }
        
                // Event listener for province change
                provinceSelect.addEventListener('change', function() {
                    const provinceId = this.value;
                    fetchDistricts(provinceId);
                });
        
                // Event listener for district change
                districtSelect.addEventListener('change', function() {
                    const districtId = this.value;
                    fetchPalikas(districtId);
                });
        
                // Initial population based on selected values
                const initialProvinceId = provinceSelect.value;
                fetchDistricts(initialProvinceId);
        
                const initialDistrictId = districtSelect.value;
                fetchPalikas(initialDistrictId);
            });
        </script>             
    </template>
    <template id="web_register_update" name="Registration Update">
        <t t-name="web.register_update">
            <t t-call="website.layout">
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
                <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                <script src="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/js/nepali.datepicker.v4.0.4.min.js" type="text/javascript"></script>
                <link href="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/css/nepali.datepicker.v4.0.4.min.css" rel="stylesheet" type="text/css"/>
                <script src="/base_accounting_kit/static/src/js/script.js"></script>
    
                <link rel="stylesheet" type="text/css" href="/base_accounting_kit/static/src/css/app.css"/>
         
                    <div class="container container-register">
                        <div class="header-box text-center">
                            <h2 class="mb-0">Update Details</h2>
                        </div>
                        <form class="oe_register_form" role="form" style="padding:5em 4em;" id="mainForm" t-attf-action="/company/update" method="post" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="company_type" class="required">Company Type</label>
                                    <!-- Disabled select field to prevent user interaction -->
                                    <select class="form-control" disabled="disabled">
                                        <option value="individual" t-att-selected="registration_record.company_type == 'individual'">
                                            Individual
                                        </option>
                                        <option value="organization" t-att-selected="registration_record.company_type == 'organization'">
                                            Organization
                                        </option>
                                    </select>
                            
                                    <!-- Hidden field to submit the value -->
                                    <input type="hidden" name="company_type" t-att-value="registration_record.company_type" />
                                </div>
                            </div>
                                                      

                            <t t-if="registration_record and registration_record.company_type == 'individual'">
                                <div id="individual_fields">
                                    <div class="row">
                                        <div class="form-group col-md-6">
                                            <label for="first_name_en" class="required">First Name (EN)</label>
                                            <input type="text" name="first_name_en" id="first_name_en" class="form-control" 
                                                placeholder="Enter First Name" 
                                                t-att-value="registration_record.first_name_en or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="middle_name_en">Middle Name (EN)</label>
                                            <input type="text" name="middle_name_en" id="middle_name_en" class="form-control" 
                                                placeholder="Enter Middle Name" 
                                                t-att-value="registration_record.middle_name_en or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="last_name_en" class="required">Last Name (EN)</label>
                                            <input type="text" name="last_name_en" id="last_name_en" class="form-control" 
                                                placeholder="Enter Last Name" 
                                                t-att-value="registration_record.last_name_en or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="first_name_np" class="required">First Name (NP)</label>
                                            <input type="text" name="first_name_np" id="first_name_np" class="form-control" 
                                                placeholder="Enter First Name in NP" 
                                                t-att-value="registration_record.first_name_np or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="middle_name_np">Middle Name (NP)</label>
                                            <input type="text" name="middle_name_np" id="middle_name_np" class="form-control" 
                                                placeholder="Enter Middle Name in NP" 
                                                t-att-value="registration_record.middle_name_np or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="last_name_np" class="required">Last Name (NP)</label>
                                            <input type="text" name="last_name_np" id="last_name_np" class="form-control" 
                                                placeholder="Enter Last Name in NP" 
                                                t-att-value="registration_record.last_name_np or ''"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="gender" class="required">Gender</label>
                                            <select name="gender" id="gender" class="form-control">
                                                <option value="">Select Gender</option>
                                                <option value="male" t-att-selected="'male' == registration_record.gender">Male</option>
                                                <option value="female" t-att-selected="'female' == registration_record.gender">Female</option>
                                                <option value="others" t-att-selected="'others' == registration_record.gender">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="login_bg_img_individual">Individual's Picture</label>
                                        
                                            <t t-if="registration_record.login_bg_img_individual">
                                                <img id="individual-logo-preview" 
                                                     t-att-src="'data:image/png;base64,' + registration_record.login_bg_img_individual.decode('utf-8')" 
                                                     alt="Company Logo" 
                                                     class="img-fluid"/>
                                            </t>
                                            <t t-else="">
                                                <img id="individual-logo-preview" 
                                                     src="" 
                                                     alt="No Logo Available" 
                                                     class="img-fluid" style="display: none;" />
                                                <p id="no-individual-text">No image available</p>
                                            </t>
                                        
                                            <input type="file" name="login_bg_img_individual" id="login_bg_img_individual" class="form-control"/>
                                        </div>
                                    </div>
                                </div>
                            </t>
                            <t t-else="">
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="organization_name_en" class="required">Organization Name (EN)</label>
                                        <input type="text" name="organization_name_en" id="organization_name_en" class="form-control" placeholder="Enter Organization Name" t-att-value="registration_record.organization_name_en"/>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="organization_name_np" class="required">Organization Name (NP)</label>
                                        <input type="text" name="organization_name_np" id="organization_name_np" class="form-control" placeholder="Enter Organization Name in NP" t-att-value="registration_record.organization_name_np"/>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="owner_name_en" class="required">Owner Name (EN)</label>
                                        <input type="text" name="owner_name_en" id="owner_name_en" class="form-control" placeholder="Enter Owner Name" t-att-value="registration_record.owner_name_en"/>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="owner_name_np" class="required">Owner Name (NP)</label>
                                        <input type="text" name="owner_name_np" id="owner_name_np" class="form-control" placeholder="Enter Owner Name in NP" t-att-value="registration_record.owner_name_np"/>
                                    </div>
                                    
                                    <div class="form-group col-md-6">
                                        <label for="registration_no">Registration Number</label>
                                        <input type="text" name="registration_no" id="registration_no" class="form-control" placeholder="Enter Registration Number" t-att-value="registration_record.registration_no"/>
                                    </div>
                                    <!-- <div class="form-group col-md-6">
                                        <label for="organization_type">Organization Type</label>
                                        <select name="organization_type" id="organization_type" class="form-control">
                                            <option value="">Select Organization Type</option>
                                            <option value="private limited" t-att-selected="'private limited' == registration_record.organization_type">Private Limited</option>
                                            <option value="public limited" t-att-selected="'public limited' == registration_record.organization_type">Public Limited</option>
                                            <option value="user committee" t-att-selected="'user committee' == registration_record.organization_type">User Committee</option>
                                            <option value="proprietary firm" t-att-selected="'proprietary firm' == registration_record.organization_type">Proprietary Firm</option>
                                            <option value="others" t-att-selected="'others' == registration_record.organization_type">Others</option>
                                        </select>
                                    </div> -->
                                    <div class="form-group col-md-6">
                                        <label for="login_bg_img_company">Company Logo</label>
                                    
                                        <t t-if="registration_record.login_bg_img_company">
                                            <img id="company-logo-preview" 
                                                 t-att-src="'data:image/png;base64,' + registration_record.login_bg_img_company.decode('utf-8')" 
                                                 alt="Company Logo" 
                                                 class="img-fluid"/>
                                        </t>
                                        <t t-else="">
                                            <img id="company-logo-preview" 
                                                 src="" 
                                                 alt="No Logo Available" 
                                                 class="img-fluid" style="display: none;" />
                                            <p id="no-logo-text">No logo available</p>
                                        </t>
                                    
                                        <input type="file" name="login_bg_img_company" id="login_bg_img_company" class="form-control"/>
                                    </div>
                                </div>
                            </t>
                            <!-- Common Fields for Both Types -->
                <div id="common_fields">
                    <div class="row">
                        <!-- <div class="form-group col-md-6">
                            <label for="company_category_ids">Business Type</label>
                            <select name="company_category_ids[]" id="company_category_ids" required="required" class="form-control js-example-basic-multiple" multiple="multiple" style="width: 100%; max-width: 600px;">
                                <t t-foreach="company_category_ids" t-as="category">
                                    <option t-att-value="category.id" t-att-selected="category.id in registration_record.company_category_ids.ids"><t t-esc="category.name_np"/></option>
                                </t>
                            </select>
                        </div> -->
                        <!-- <div class="form-group col-md-6">
                            <label for="address">Address</label>
                            <input type="text" name="address" id="address" class="form-control" placeholder="Enter Address" t-att-value="registration_record.address"/>
                        </div> -->
                    
                        <!-- <div class="form-group col-md-6">
                            <label for="city">City</label>
                            <input type="text" name="city" id="city" class="form-control" placeholder="Enter City" t-att-value="registration_record.city"/>
                        </div> -->
                        <div class="form-group col-md-6">
                            <label for="owner_citizenship_front">Owner Citizenship (Front)</label>
                        
                            <t t-if="registration_record.owner_citizenship_front">
                                <img id="owner-citizenship-front-preview" 
                                     t-att-src="'data:image/png;base64,' + registration_record.owner_citizenship_front.decode('utf-8')" 
                                     alt="Owner Citizenship (Front)" 
                                     class="img-fluid"/>
                            </t>
                            <t t-else="">
                                <img id="owner-citizenship-front-preview" 
                                     src="" 
                                     alt="No image Available" 
                                     class="img-fluid" style="display: none;" />
                                <p id="no-front-text">No image available</p>
                            </t>
                        
                            <input type="file" name="owner_citizenship_front" id="owner_citizenship_front" class="form-control"/>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="owner_citizenship_back">Owner Citizenship (Back)</label>
                        
                            <t t-if="registration_record.owner_citizenship_back">
                                <img id="owner-citizenship-back-preview" 
                                     t-att-src="'data:image/png;base64,' + registration_record.owner_citizenship_back.decode('utf-8')" 
                                     alt="Owner Citizenship (Back)" 
                                     class="img-fluid"/>
                            </t>
                            <t t-else="">
                                <img id="owner-citizenship-back-preview" 
                                     src="" 
                                     alt="No image Available" 
                                     class="img-fluid" style="display: none;" />
                                <p id="no-back-text">No image available</p>
                            </t>
                        
                            <input type="file" name="owner_citizenship_back" id="owner_citizenship_back" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="phone">Phone</label>
                            <input type="text" name="phone" id="phone" class="form-control" placeholder="Enter Phone" t-att-value="registration_record.phone"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="mobile" class="required">Mobile</label>
                            <input type="text" name="mobile" id="mobile" class="form-control" placeholder="Enter Mobile" t-att-value="registration_record.mobile"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="email" class="required">Email</label>
                            <input type="email" name="email" id="email" class="form-control" placeholder="Enter Email" t-att-value="registration_record.email"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="pan_number" class="required">Pan Number</label>
                            <input type="pan_number" name="pan_number" id="pan_number" class="form-control" placeholder="Enter Pan Number" t-att-value="registration_record.pan_number"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="tax_id">Tax ID</label>
                            <input type="tax_id" name="tax_id" id="tax_id" class="form-control" placeholder="Enter Tax ID" t-att-value="registration_record.tax_id"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="update_code">Update Code</label>
                            <input type="text" name="update_code" id="update_code" 
                                   class="form-control" placeholder="Enter Update Code" 
                                   t-att-value="registration_record.update_code" readonly="readonly"/>
                        </div>                      
                        <div class="form-group col-md-6">
                            <label for="province" class="required">Province</label>
                            <select name="province" id="province" class="form-control">

                                <option t-att-value="registration_record.province.id" selected="selected">
                                    <t t-esc="registration_record.province.name_np"/>
                                </option>

                                <t t-foreach="provinces" t-as="province">
                                    <t t-if="province.id != registration_record.province.id">
                                        <option t-att-value="province.id">
                                            <t t-esc="province.name_np"/>
                                        </option>
                                    </t>
                                </t>                                
                            </select>
                        </div>                             
                        <div class="form-group col-md-6">
                            <label for="district" class="required">District</label>
                            <select name="district" id="district" class="form-control">
                                <option t-att-value="registration_record.district.id"><t t-esc="registration_record.district.district_name_np"/></option>
                                <t t-foreach="districts" t-as="district">
                                    <option t-att-value="district.id"><t t-esc="district.district_name_np"/></option>
                                </t>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="palika" class="required">Palika</label>
                            <select name="palika" id="palika" class="form-control">
                                <option t-att-value="registration_record.palika.id"><t t-esc="registration_record.palika.palika_name_np"/></option>
                                <t t-foreach="palikas" t-as="palika">
                                    <option t-att-value="palika.id"><t t-esc="palika.palika_name_np"/></option>
                                </t>
                            </select>
                        </div> 
                        <div class="form-group col-md-6">
                            <label for="ward_no">Ward No</label>
                            <input type="text" name="ward_no" id="ward_no" 
                                   class="form-control" placeholder="Enter Ward No" 
                                   t-att-value="registration_record.ward_no"/>
                        </div>   
                        <div class="form-group col-md-6">
                            <div id="revert_fields" t-att-value="revert_fields" style="display:none;"></div>
                        </div>                    
                        <!-- <div class="form-group col-md-6">
                            <label for="website">Website</label>
                            <input type="url" name="website" id="website" class="form-control" placeholder="Enter Website" t-att-value="registration_record.website"/>
                        </div> -->
                        <!-- <div class="form-group col-md-6">
                            <label for="password">Password</label>
                            <input type="password" name="password" id="password" class="form-control" placeholder="Enter Password" required="required"/>
                        </div> -->
                        <!-- <div class="form-group col-md-6">
                            <label for="confirm_password">Confirm Password</label>
                            <input type="password" name="confirm_password" id="confirm_password" class="form-control" placeholder="Confirm Password" required="required"/>
                        </div> -->
                    </div>
                </div>

                        <div class="form-group text-center mt-4">
                            <button type="submit" class="btn btn-primary">Update</button>
                        </div>
                        </form>
                    </div>
            </t>
        </t>
        <script>
            function setupImagePreview(inputId, previewId, noTextId) {
                const inputElement = document.getElementById(inputId);
                const previewImage = document.getElementById(previewId);
                const noLogoText = document.getElementById(noTextId);

                if (inputElement) {
                    inputElement.addEventListener('change', function (event) {
                        const file = event.target.files[0];

                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                if (previewImage) {
                                    previewImage.src = e.target.result;
                                    previewImage.style.display = 'block';  // Show the image
                                }
                                if (noLogoText) noLogoText.style.display = 'none';  // Hide "No logo available" text
                            };
                            reader.readAsDataURL(file);
                        } else {
                            if (previewImage) {
                                previewImage.src = '';  // Clear the image
                                previewImage.style.display = 'none';  // Hide the preview image
                            }
                            if (noLogoText) noLogoText.style.display = 'block';  // Show "No logo available" text
                        }
                    });
                }
            }







            document.addEventListener('DOMContentLoaded', function() {
                setupImagePreview('login_bg_img_company', 'company-logo-preview', 'no-logo-text');
                setupImagePreview('owner_citizenship_front', 'owner-citizenship-front-preview', 'no-front-text');
                setupImagePreview('owner_citizenship_back', 'owner-citizenship-back-preview', 'no-back-text');
                setupImagePreview('login_bg_img_individual', 'individual-logo-preview', 'no-individual-text');
                const form = document.querySelector('form');
                const submitButton = document.getElementById('submitButton');
                const provinceSelect = document.getElementById('province');
                const districtSelect = document.getElementById('district');
                const palikaSelect = document.getElementById('palika');
                renderFields();
                <!-- submitButton.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent the default form submission

                    console.log("Button clicked");
                    // Your other console.log statements here
                    // Delay the form submission
                    setTimeout(function() {
                        // Create hidden inputs for each selected option
                        // Your code for creating hidden inputs goes here

                        // Submit the form programmatically
                        form.submit();
                    }, 1000000); // 2000 milliseconds (2 seconds) delay
                }); -->
                function renderFields() {
                    const fields = document.getElementById('revert_fields');
                    if (fields) {
                        const value = fields.getAttribute('value');
                
                        try {
                            const fieldArray = JSON.parse(value.replace(/'/g, '"'));
                
                            // Loop through each ID in the fieldArray
                            fieldArray.forEach(fieldId => {
                                // Find the element with the matching ID
                                const fieldElement = document.getElementById(fieldId);
                
                                // If the element exists, change its styles to make it more visible
                                if (fieldElement) {
                                    fieldElement.style.border = '3px solid red'; // Thicker red border
                                    fieldElement.style.backgroundColor = '#ffe6e6'; // Light red background
                                    fieldElement.style.color = 'darkred'; // Text color to match the theme
                                    fieldElement.style.boxShadow = '0 0 10px 2px rgba(255, 0, 0, 0.5)'; // Red shadow for emphasis
                                }
                            });
                        } catch (e) {
                            console.error('Error parsing value:', e);
                        }
                    }
                }                
        
                // Function to fetch districts based on selected province
                function fetchDistricts(provinceId) {
                    districtSelect.innerHTML = '<option value="">Select District</option>';
                    palikaSelect.innerHTML = '<option value="">Select Palika</option>'; // Clear palikas
                    if (provinceId) {
                        fetch(`/district/${provinceId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.districts.forEach(district => {
                                    const option = new Option(district.name, district.id);
                                    districtSelect.add(option);
                                });
                            });
                    }
                }
        
                // Function to fetch palikas based on selected district
                function fetchPalikas(districtId) {
                    if (districtId) {
                        fetch(`/palika/${districtId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.palikas.forEach(palika => {
                                    const option = new Option(palika.name, palika.id);
                                    palikaSelect.add(option);
                                });
                            });
                    }
                }

                function initialfetchDistricts(provinceId) {
                    if (provinceId) {
                        fetch(`/district/${provinceId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.districts.forEach(district => {
                                    const option = new Option(district.name, district.id);
                                    if (String(district.id) === districtSelect.value) {
                                    }
                                    else{
                                        districtSelect.add(option);
                                    }
                                });
                            });
                    }
                }
        
                // Function to fetch palikas based on selected district
                function initialfetchPalikas(districtId) {
                    if (districtId) {
                        fetch(`/palika/${districtId}`)
                            .then(response => response.json())
                            .then(data => {
                                data.palikas.forEach(palika => {
                                    const option = new Option(palika.name, palika.id);
                                    if (String(palika.id) === palikaSelect.value) {
                                    }
                                    else{
                                        palikaSelect.add(option);
                                    }
                                });
                            });
                    }
                }
        
                // Event listener for province change
                provinceSelect.addEventListener('change', function() {
                    const provinceId = this.value;
                    fetchDistricts(provinceId);
                });
        
                // Event listener for district change
                districtSelect.addEventListener('change', function() {
                    const districtId = this.value;
                    fetchPalikas(districtId);
                });
                // Initial population based on selected values
                const initialProvinceId = provinceSelect.value;
                initialfetchDistricts(initialProvinceId);
        
                const initialDistrictId = districtSelect.value;
                initialfetchPalikas(initialDistrictId);
        
            });
        </script>
    </template>
    <template id="web_register_thank_you" name="Thank You Page">
        <t t-name="web.register_thank_you">
            <t t-call="website.layout">
                <div class="container mt-5">
                    <h2>Thank You for Registering Your Company!</h2>
                    <p>Your company registration request has been successfully submitted. Our team will get back to you shortly.</p>
                    <a href="/" class="btn btn-primary mt-3">Go to Homepage</a>
                    <a t-attf-href="{{quotation_link}}" class="btn btn-primary mt-3">View Quotation</a>
                    <a t-attf-href="{{invoice_link}}" class="btn btn-primary mt-3">View Invoice</a>
                </div>
            </t>
        </t>
    </template>
    <template id="web_update_thank_you" name="Thank You Page">
        <t t-name="web.update_thank_you">
            <t t-call="website.layout">
                <div class="container mt-5">
                    <h2>Thank You for Updating Your Details!</h2>
                    <p>Your details update request has been successfully submitted. Our team will get back to you shortly.</p>
                    <a href="/" class="btn btn-primary mt-3">Go to Homepage</a>
                    <!-- <a t-attf-href="{{quotation_link}}" class="btn btn-primary mt-3">View Quotation</a>
                    <a t-attf-href="{{invoice_link}}" class="btn btn-primary mt-3">View Invoice</a> -->
                </div>
            </t>
        </t>
    </template>
    <template id="web_login_extend" inherit_id="web.login">
        <xpath expr="//form" position="after">
            <div class="text-center mt-3">
                <a href="/web/register" class="btn btn-primary">Sign Up</a>
            </div>
        </xpath>
    </template>  

    <template id="payment_not_done" name="Registration Failed">
        <t t-name="web.payment_not_done">
            <t t-call="website.layout">
                <div class="container mt-5">
                    <p class="text-center">Please complete the payment process first. If you have already made payment and this is by mistake please contact the administration as soon as possible with valid reference number.</p>
                    <a href="/" class="btn btn-primary mt-3">Go to Homepage</a>
                </div>
            </t>
        </t>
    </template>



    <template id="web_system_client_error" name="Oops! Something Went Wrong">
        <t t-name="web.register_thank_you">
            <t t-call="website.layout">
                <div class="container mt-5">
                    <h2>Oops! Something Went Wrong</h2>
                    <p>Hmm, That Didn't Go As Planned! The error you are stumbled upon is -<t t-esc="error"/></p>
                </div>
            </t>
        </t>
    </template>
</odoo>